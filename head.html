<meta
  http-equiv="Content-Security-Policy"
  content="script-src 'nonce-aem' 'strict-dynamic' 'unsafe-inline' http: https:; base-uri 'self'; object-src 'none';"
  move-to-http-header="true"
>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script nonce="aem" type="module">
  import { fromEds } from '/scripts/from-eds.js';
  // Wrap all experience-element blocks in a structure that fromEds expects
const wrapper = document.createElement('div');
let main = document.querySelector('main');
const blocks = Array.from(main.querySelectorAll('.experience-element'))
  .map((block) => {
    const html = block.outerHTML;
    return html;
  })
  .join('');
wrapper.innerHTML = `<body><header></header><main>${blocks}</main></body>`;
main.innerHTML = '';

// Convert the EDS block to custom element markup
const customElementHtml = fromEds(wrapper.innerHTML);

// Parse the result and get the custom element
const parser = new DOMParser();
const doc = parser.parseFromString(customElementHtml, 'text/html');
let customElement = doc.body.firstElementChild;

// Create a new main element to hold the content
const newMain = document.createElement('main');

// Check if sp-theme is already the root element
if (customElement.tagName.toLowerCase() === 'sp-theme') {
  // Move sp-theme's children into newMain
  while (customElement.firstChild) {
    newMain.appendChild(customElement.firstChild);
  }
  customElement.appendChild(newMain);
  main.replaceWith(customElement);
} else {
  // Wrap content in sp-theme
  const spTheme = document.createElement('sp-theme');
  spTheme.setAttribute('system', 'spectrum-two');
  spTheme.setAttribute('color', 'light');
  spTheme.setAttribute('scale', 'medium');
  newMain.appendChild(customElement);
  spTheme.appendChild(newMain);
  main.replaceWith(spTheme);
}
</script>
<script nonce="aem" src="/scripts/bundle.js" type="module"></script>
<script nonce="aem" src="/scripts/from-eds.js" type="module"></script>
<mas-commerce-service></mas-commerce-service>